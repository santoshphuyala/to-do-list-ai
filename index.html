<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="theme-color" content="#1DA1F2">
    
    <meta name="description" content="Advanced To-Do List with AI Insights">
    <title>TaskMaster Pro - Advanced To-Do List</title>

    <link rel="manifest" href="manifest.json">

    <link rel="icon" type="image/png" href="icons/android-chrome-192x192.png" sizes="192x192">
    
    <link rel="apple-touch-icon" href="android-chrome-192x192.png">

   <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">

</head>
<body>
    <div id="pinLockScreen" class="pin-lock-screen hidden">
        <div class="pin-container">
            <i class="fas fa-lock pin-icon"></i>
            <h2>Enter PIN</h2>
            <input type="password" id="pinInput" maxlength="6" placeholder="Enter your PIN">
            <button onclick="verifyPin()" class="btn btn-primary">Unlock</button>
            <p class="pin-error hidden" id="pinError">Incorrect PIN</p>
        </div>
    </div>

    <div id="mainApp">
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <h1><i class="fas fa-check-circle"></i> TaskMaster Pro</h1>
                    <div class="header-actions">
                        <button class="icon-btn" onclick="toggleDarkMode()" title="Toggle Dark Mode" aria-label="Toggle Dark Mode">
                            <i class="fas fa-moon" id="themeIcon"></i>
                        </button>
                        <button class="icon-btn" onclick="showInsights()" title="Full Insights Report" aria-label="Full Insights Report">
                            <i class="fas fa-chart-line"></i>
                        </button>
                        <button class="icon-btn" onclick="showQuickExportMenu()" title="Quick Export" aria-label="Quick Export">
                            <i class="fas fa-file-export"></i>
                        </button>
                        <button class="icon-btn" onclick="document.getElementById('quickImportFile').click()" title="Quick Import" aria-label="Quick Import">
                            <i class="fas fa-file-import"></i>
                        </button>
                        <input type="file" 
                               id="quickImportFile" 
                               accept=".json,.xlsx" 
                               onchange="importFile(event)" 
                               style="display: none;">
                        <button class="icon-btn" onclick="openSettings()" title="Settings" aria-label="Settings">
                            <i class="fas fa-cog"></i>
                        </button> 
                                    </div> <a href="Shopping list manager/shopping manager.html"> <strong>Shopping List Manager </strong></a>

                    </div>
                </div>
            </div>
        </header>

        <!-- Quick Export Menu (Hidden by default) -->
        <div id="quickExportMenu" class="quick-export-menu" style="display: none;">
            <div class="quick-export-content">
                <h4><i class="fas fa-file-export"></i> Export Tasks</h4>
                <div class="export-options">
                    <button onclick="exportToJSON(); hideQuickExportMenu();" class="export-option">
                        <i class="fas fa-code"></i>
                        <span>JSON</span>
                    </button>
                    <button onclick="exportToExcel(); hideQuickExportMenu();" class="export-option">
                        <i class="fas fa-file-excel"></i>
                        <span>Excel</span>
                    </button>
                    <button onclick="exportToPDF(); hideQuickExportMenu();" class="export-option">
                        <i class="fas fa-file-pdf"></i>
                        <span>PDF</span>
                    </button>
                </div>
            </div>
        </div>

       

        <!-- Quick Add Section -->
        <div class="quick-add-container">
            <div class="quick-input-wrapper" role="region" aria-label="Quick add task">
                <i class="input-icon fas fa-plus-circle" aria-hidden="true"></i>
                <input type="text"
                       id="quickTaskInput"
                       class="quick-task-input"
                       placeholder="Quick add a task... (Press Enter)"
                       aria-label="Quick add task">
                <button onclick="quickAddTask()" class="btn-quick-add" aria-label="Add task">
                    <i class="fas fa-plus"></i> Quick Add
                </button>
                <button onclick="openAdvancedForm()" class="btn-quick-add" aria-label="Open advanced form">
                    <i class="fas fa-edit"></i> Advanced
                </button>
            </div>
        </div>

        </section>

        <section class="filter-section">
            <div class="container">
                
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" placeholder="Search tasks, descriptions, or tags..." class="search-input">
                    <button id="clearSearchBtn" class="clear-search-btn hidden" onclick="clearSearch()" aria-label="Clear search">
                        <i class="fas fa-times"></i>
                    </button>
                </div><br>
                
                <div class="tabs">
                    <div class="main-tabs">
                        <button class="tab active" onclick="filterTasks('all')">All</button>
                        <button class="tab" onclick="filterTasks('personal')">Personal</button>
                        <button class="tab" onclick="filterTasks('office')">Office</button>
                        <button class="tab" onclick="filterTasks('misc')">Misc</button>
                        <button class="tab" onclick="filterTasks('recurring')">Recurring</button>
                    </div>
                    <div class="tab-separator"></div>
                    <div class="completed-tabs">
                        <button class="tab completed-tab" onclick="filterTasks('completed')">Completed</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- *** NEW: Quick Filters Section *** -->
        <div class="quick-filters-section">
            <div class="filter-group">
                <div class="filter-group-header">
                    <i class="fas fa-calendar-check"></i>
                    <span>Quick Filters</span>
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn" 
                            id="filter-overdue" 
                            onclick="applyQuickFilter('overdue')"
                            title="Show overdue tasks">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Overdue</span>
                        <span class="filter-count" id="count-overdue">0</span>
                    </button>
                    <button class="filter-btn" 
                            id="filter-today" 
                            onclick="applyQuickFilter('today')"
                            title="Show today's tasks">
                        <i class="fas fa-calendar-day"></i>
                        <span>Today</span>
                        <span class="filter-count" id="count-today">0</span>
                    </button>
                    <button class="filter-btn" 
                            id="filter-week" 
                            onclick="applyQuickFilter('week')"
                            title="Show this week's tasks">
                        <i class="fas fa-calendar-week"></i>
                        <span>This Week</span>
                        <span class="filter-count" id="count-week">0</span>
                    </button>
                </div>
            </div>
            
            <div class="filter-group">
                <div class="filter-group-header">
                    <i class="fas fa-flag"></i>
                    <span>Priority Filters</span>
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn priority-urgent" 
                            id="filter-urgent" 
                            onclick="applyPriorityFilter('urgent')"
                            title="Show urgent tasks">
                        <i class="fas fa-fire"></i>
                        <span>Urgent</span>
                        <span class="filter-count" id="count-urgent">0</span>
                    </button>
                    <button class="filter-btn priority-high" 
                            id="filter-high" 
                            onclick="applyPriorityFilter('high')"
                            title="Show high priority tasks">
                        <i class="fas fa-arrow-up"></i>
                        <span>High</span>
                        <span class="filter-count" id="count-high">0</span>
                    </button>
                    <button class="filter-btn priority-medium" 
                            id="filter-medium" 
                            onclick="applyPriorityFilter('medium')"
                            title="Show medium priority tasks">
                        <i class="fas fa-minus"></i>
                        <span>Medium</span>
                        <span class="filter-count" id="count-medium">0</span>
                    </button>
                    <button class="filter-btn priority-low" 
                            id="filter-low" 
                            onclick="applyPriorityFilter('low')"
                            title="Show low priority tasks">
                        <i class="fas fa-arrow-down"></i>
                        <span>Low</span>
                        <span class="filter-count" id="count-low">0</span>
                    </button>
                </div>
            </div>
            
            <button class="clear-filters-btn" 
                    id="clearFiltersBtn" 
                    onclick="clearQuickFilters()"
                    style="display: none;"
                    title="Clear all filters">
                <i class="fas fa-times-circle"></i>
                Clear Filters
            </button>
        </div>

        <!-- Page Size Selector and Undo/Redo Controls -->
        <div class="controls-top-container">
            <div class="controls-left">
                <div class="page-size-selector-top">
                    <label for="pageSizeSelectTop">Tasks per page:</label>
                    <select id="pageSizeSelectTop" class="form-control" onchange="changePageSizeTop()">
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="30">30</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
            <div class="controls-right">
                <div class="undo-redo-controls">
                    <button id="undoBtn" class="btn btn-secondary btn-sm" onclick="undo()" disabled title="Undo (Ctrl+Z)">
                        <i class="fas fa-undo"></i>
                    </button>
                    <button id="redoBtn" class="btn btn-secondary btn-sm" onclick="redo()" disabled title="Redo (Ctrl+Y)">
                        <i class="fas fa-redo"></i>
                    </button>
                    <span class="auto-save-indicator" id="autoSaveIndicator">
                        <i class="fas fa-check-circle"></i> Auto-saved
                    </span>
                </div>
            </div>
        </div>

        <section class="tasks-section">
            <div class="container">

                <div id="bulkActionsContainer" class="bulk-actions-bar hidden">
                    <div class="select-all-container">
                        <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll(event)">
                        <label for="selectAllCheckbox">Select All</label>
                    </div>
                    <div class="sort-container">
                        <label for="sortSelect">Sort By:</label>
                        <select id="sortSelect" class="form-control">
                            <option value="order">Manual Order</option>
                            <option value="priority">Priority</option>
                            <option value="dueDate">Due Date</option>
                            <option value="title">Title (A-Z)</option>
                        </select>
                    </div>
                    <button id="deleteSelectedBtn" class="btn btn-danger" onclick="deleteSelectedTasks()" disabled>
                        Delete Selected (0)
                    </button>
                </div>

                <div id="tasksContainer" class="tasks-table-container" ondragover="handleDragOver(event)" ondrop="handleDrop(event)">
                    <table class="tasks-table">
                        <thead>
                            <tr>
                                <th class="checkbox-column">
                                    <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll(event)">
                                </th>
                                <th class="title-column">Task</th>
                                <th class="category-column">Category</th>
                                <th class="priority-column">Priority</th>
                                <th class="due-date-column">Due Date</th>
                                <th class="actions-column">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tasksTableBody">
                            <!-- Tasks will be rendered here -->
                        </tbody>
                    </table>
                    
                    <!-- Pagination Controls -->
                    <div class="pagination-container" id="paginationContainer">
                        <div class="pagination-info">
                            <span id="paginationInfo">Showing 1-10 of 0 tasks</span>
                        </div>
                        <div class="pagination-controls">
                            <div class="pagination-buttons">
                                <button id="prevPageBtn" class="btn btn-secondary" onclick="goToPreviousPage()" disabled>
                                    <i class="fas fa-chevron-left"></i> Previous
                                </button>
                                <div class="page-numbers" id="pageNumbers">
                                    <!-- Page numbers will be generated here -->
                                </div>
                                <button id="nextPageBtn" class="btn btn-secondary" onclick="goToNextPage()" disabled>
                                    Next <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        <section class="tasks-section">

        <div id="taskModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">Add New Task</h2>
                    <button class="close-btn" onclick="closeTaskModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="taskForm" onsubmit="saveTask(event)">
                    <input type="hidden" id="taskId">
                    <input type="hidden" id="taskParentId">
                    
                    <div class="form-group">
                        <label for="taskTitle">Task Title *</label>
                        <input type="text" id="taskTitle" required class="form-control">
                    </div>

                    <div class="form-group">
                        <label for="taskDescription">Description</label>
                        <textarea id="taskDescription" rows="3" class="form-control"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskCategory">Category *</label>
                            <select id="taskCategory" required class="form-control">
                                <option value="personal">Personal</option>
                                <option value="office">Office</option>
                                <option value="misc">Misc Work</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="taskPriority">Priority *</label>
                            <select id="taskPriority" required class="form-control">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskDueDate">Due Date</label>
                            <input type="datetime-local" id="taskDueDate" class="form-control">
                        </div>

                        <div class="form-group">
                            <label for="taskReminder">Reminder</label>
                            <input type="datetime-local" id="taskReminder" class="form-control">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="taskRepeat" onchange="toggleRepeatOptions()">
                            Repetitive Task
                        </label>
                        <div id="repeatOptions" class="repeat-options hidden">
                            <label for="repeatFrequency" class="sr-only">Repeat Frequency</label>
                            <select id="repeatFrequency" class="form-control">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="taskTags">Tags (comma separated)</label>
                        <input type="text" id="taskTags" placeholder="work, urgent, meeting" class="form-control">
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeTaskModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Task</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="insightsModal" class="modal hidden">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2><i class="fas fa-chart-line"></i> Full Insights Report</h2>
                    <button class="close-btn" onclick="closeInsightsModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="insightsContent" class="insights-content">
                    </div>
            </div>
        </div>

        <div id="settingsModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-cog"></i> Settings</h2>
                    <button class="close-btn" onclick="closeSettingsModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="settings-content">
                    <h3>Default Options</h3>
                    
                    <div class="form-group">
                        <label for="defaultCategory">Default Category</label>
                        <select id="defaultCategory" class="form-control">
                            <option value="personal">Personal</option>
                            <option value="office">Office</option>
                            <option value="misc">Misc Work</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="defaultPriority">Default Priority</label>
                        <select id="defaultPriority" class="form-control">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="defaultReminderHours">Default Reminder (hours before due)</label>
                        <input type="number" id="defaultReminderHours" min="0" value="2" class="form-control">
                    </div>

                    <h3>Security</h3>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enablePin" onchange="togglePinSetting()">
                            Enable PIN Protection
                        </label>
                        <div id="pinSettings" class="pin-settings hidden">
                            <label for="newPin" class="sr-only">New PIN</label>
                            <input type="password" id="newPin" maxlength="6" placeholder="Enter 6-digit PIN" class="form-control">
                            <label for="confirmPin" class="sr-only">Confirm PIN</label>
                            <input type="password" id="confirmPin" maxlength="6" placeholder="Confirm PIN" class="form-control">
                            <button onclick="savePinSettings()" class="btn btn-primary">Save PIN</button>
                        </div>
                    </div>

                    <h3>Data Management</h3>
                    <div class="form-group">
                        <label>Danger Zone</label>
                        <button onclick="clearAllTasks()" class="btn btn-danger">
                            <i class="fas fa-exclamation-triangle"></i> Clear All Tasks
                        </button>
                        <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
                            This will permanently delete all tasks and cannot be undone.
                        </p>
                    </div>


                    <h3>Import / Export</h3>
                    
                    <div class="import-export-section">
                        <button onclick="exportToJSON()" class="btn btn-secondary">
                            <i class="fas fa-file-code"></i> Export to JSON
                        </button>
                        <button onclick="exportToExcel()" class="btn btn-secondary">
                            <i class="fas fa-file-excel"></i> Export to Excel
                        </button>
                        <button onclick="exportToPDF()" class="btn btn-secondary">
                            <i class="fas fa-file-pdf"></i> Export to PDF
                        </button>
                        <button onclick="exportToGoogleCalendar()" class="btn btn-secondary">
                            <i class="fab fa-google"></i> Export to Google Calendar
                        </button>
                        
                        <div class="import-section">
                            <label for="importFile" class="btn btn-primary">
                                <i class="fas fa-upload"></i> Import File
                            </label>
                            <input type="file" id="importFile" accept=".json,.xlsx" onchange="importFile(event)" style="display: none;">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="importOptionsModal" class="modal hidden">
            <div class="modal-content large-modal">
                <div class="modal-header">
                    <h2 id="importOptionsTitle"><i class="fas fa-upload"></i> Smart Import Preview</h2>
                    <button class="close-btn" onclick="handleImportCancel()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="settings-content" style="padding: 1.5rem;">
                    <div class="import-summary">
                        <div class="import-stats">
                            <div class="stat-item">
                                <i class="fas fa-file-alt"></i>
                                <span class="stat-label">File Type:</span>
                                <span class="stat-value" id="fileType">JSON</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-tasks"></i>
                                <span class="stat-label">Total Tasks:</span>
                                <span class="stat-value" id="totalTasks">0</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-plus-circle"></i>
                                <span class="stat-label">New Tasks:</span>
                                <span class="stat-value new-tasks" id="newTasksCount">0</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-copy"></i>
                                <span class="stat-label">Duplicates:</span>
                                <span class="stat-value duplicate-tasks" id="duplicateTasksCount">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="import-preview-section">
                        <h4><i class="fas fa-eye"></i> Task Preview</h4>
                        <div class="preview-controls">
                            <label>
                                <input type="checkbox" id="showDuplicatesOnly" onchange="filterPreview()">
                                Show duplicates only
                            </label>
                            <label>
                                <input type="checkbox" id="showNewOnly" onchange="filterPreview()">
                                Show new tasks only
                            </label>
                        </div>
                        <div class="preview-table-container">
                            <table class="preview-table" id="previewTable">
                                <thead>
                                    <tr>
                                        <th>Status</th>
                                        <th>Title</th>
                                        <th>Category</th>
                                        <th>Priority</th>
                                        <th>Due Date</th>
                                    </tr>
                                </thead>
                                <tbody id="previewTableBody">
                                    <!-- Preview rows will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="import-options-grid">
                        <button class="import-option-btn merge-btn" onclick="handleImportMerge()">
                            <i class="fas fa-plus-circle option-icon" style="color: #22c55e;"></i>
                            <span class="option-title">Incremental Import</span>
                            <span class="option-desc">Add only new tasks, skip duplicates.</span>
                            <span class="option-info" id="mergeInfo">
                                <strong id="newCount">0</strong> new tasks will be added.
                            </span>
                        </button>

                        <button class="import-option-btn update-btn" onclick="handleImportUpdate()">
                            <i class="fas fa-sync option-icon" style="color: #3b82f6;"></i>
                            <span class="option-title">Update Existing</span>
                            <span class="option-desc">Update duplicates and add new tasks.</span>
                            <span class="option-info" id="updateInfo">
                                <strong id="updateCount">0</strong> updated, <strong id="newUpdateCount">0</strong> added.
                            </span>
                        </button>

                        <button class="import-option-btn overwrite-btn" onclick="handleImportOverwrite()">
                            <i class="fas fa-exclamation-triangle option-icon" style="color: #ef4444;"></i>
                            <span class="option-title">Replace All</span>
                            <span class="option-desc">Delete all current tasks and replace with file.</span>
                            <span class="option-warning">
                                <i class="fas fa-exclamation-circle"></i> This cannot be undone.
                            </span>
                        </button>
                    </div>

                    <div class="duplicate-resolution-options">
                        <h4><i class="fas fa-cogs"></i> Duplicate Detection Settings</h4>
                        <div class="resolution-settings">
                            <label>
                                <input type="checkbox" id="matchTitle" checked>
                                Match by title
                            </label>
                            <label>
                                <input type="checkbox" id="matchCategory" checked>
                                Match by category
                            </label>
                            <label>
                                <input type="checkbox" id="matchPriority">
                                Match by priority
                            </label>
                            <label>
                                <input type="checkbox" id="matchDueDate">
                                Match by due date
                            </label>
                        </div>
                    </div>
                        </button>

                        <button class="import-option-btn cancel-btn" onclick="handleImportCancel()">
                            <i class="fas fa-ban option-icon" style="color: #64748b;"></i>
                            <span class="option-title">Cancel</span>
                            <span class="option-desc">Do not import anything and close this dialog.</span>
                        </button>
                        
                    </div>
                </div>
            </div>
        </div>


        <footer class="footer">
            <div class="container">
                <p>Developed with ❤️ by <strong>Santosh Phuyal</strong></p>
                <p class="footer-links">
                    <a href="#" onclick="showAbout()">About</a> •
                    <a href="#" onclick="showHelp()">Help</a> •
                    <a href="#" onclick="showPrivacy()">Privacy</a>
                </p>
            </div>
        </footer>
    </div>

    <div id="toast" class="toast hidden"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/idb@7/build/umd.js"></script>
    <script src="app.js?v=5.3"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js') // Use relative path
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed', err));
            });
        }
    </script>
</body>

</html>
